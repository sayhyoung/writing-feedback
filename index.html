<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Writing Assistant</title>
  <style>
    /* --- 레이아웃 & 기본 스타일 --- */
    body {
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background: #f0f4f8;
      margin: 0; padding: 2rem;
      display: flex; justify-content: center;
      line-height: 1.6;
    }
    #container {
      width: 100%; max-width: 700px;
      background: #fff; border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      padding: 2rem; position: relative;
    }
    h1 { text-align: center; color: #004a99; margin-bottom: 1rem; }
    #reset-btn {
      position: absolute; top: 2rem; right: 2rem;
      background: #0066cc; color: #fff;
      border: none; border-radius: 4px;
      padding: 0.5rem 1rem; cursor: pointer;
      transition: background .2s;
    }
    #reset-btn:hover { background: #0052a3; }
    nav { text-align: center; margin-bottom: 1rem; }
    .tab {
      background: #e9f5ff; color: #004a99;
      border: none; padding: .5rem 1rem;
      margin: 0 .5rem; border-radius: 4px;
      cursor: pointer; font-weight: bold;
      transition: background .2s ease;
    }
    .tab.active { background: #0066cc; color: #fff; }
    .tab:hover:not(.active) { background: #d4edff; }
    .section { display: none; }
    .section.active { display: block; }
    .user-info { display: flex; gap: 1rem; margin: 0.5rem 0; }
    .user-info input {
      flex: 1; padding: .5rem;
      border: 1px solid #cbd7e0; border-radius: 4px;
      font-size: 14px;
    }
    .input-area {
      width: 100%; min-height: 150px; padding: 1rem;
      border: 2px solid #cbd7e0; border-radius: 8px;
      background: #f9fcff; resize: vertical;
      transition: border-color .3s; box-sizing: border-box;
      font-family: inherit; font-size:14px; line-height:1.5;
    }
    .input-area:focus { outline: none; border-color: #0066cc; }
    .action-icons { display: flex; justify-content: flex-end; gap: .5rem; margin-bottom: .5rem; }
    .icon-btn {
      width:32px; height:32px; border:none; border-radius:6px;
      background:#fff; box-shadow:0 2px 4px rgba(0,0,0,0.1);
      display:flex; align-items:center; justify-content:center;
      position:relative; cursor:pointer; transition:background .2s;
    }
    .icon-btn:hover { background:#f0f4f8; }
    .icon-btn input[type="file"] {
      position:absolute; top:0; left:0; width:100%; height:100%;
      opacity:0; cursor:pointer;
    }
    .file-info, .ocr-status {
      margin-top:.5rem; padding:.5rem;
      border-radius:4px; font-size:.9rem;
    }
    .file-info { background:#e9f5ff; display:none; }
    .file-info.show { display:flex; }
    .file-info .file-name { flex:1; color:#004a99; font-weight:500; }
    .ocr-status {
      background:#fff3cd; border:1px solid #ffeaa7;
      color:#856404; display:none; align-items:center; gap:.5rem;
    }
    .ocr-status.show { display:flex; }
    .ocr-status .spinner {
      width:16px; height:16px;
      border:2px solid #856404; border-top:2px solid transparent;
      border-radius:50%; animation:spin 1s linear infinite;
    }
    @keyframes spin { to { transform:rotate(360deg); } }
    button:not(.icon-btn), a.button {
      background:#0066cc; color:#fff;
      border:none; border-radius:4px;
      padding:.75rem 1.5rem; cursor:pointer;
      transition:background .2s; margin:.5rem 0;
      display:inline-block; text-decoration:none;
    }
    button:hover, a.button:hover { background:#0052a3; }
    .btn-group { text-align:right; margin-top:0.5rem; }
    .download-link {
      display:none; margin:.5rem 0;
      color:#0066cc; text-decoration:underline;
      cursor:pointer;
    }
    .spinner {
      display:none; width:16px; height:16px;
      border:2px solid #0066cc; border-top:2px solid transparent;
      border-radius:50%; animation:spin 1s linear infinite;
      vertical-align:middle; margin-left:.5rem;
    }
    .model-box, .box {
      background:#fff; padding:1rem; margin-top:1rem;
      border-radius:4px;
    }
    .model-box h2, .box h2 { margin:0 0 .5rem; color:#004a99; }
    .print-options-inline {
      margin-top:1rem; padding:1rem;
      background:#f9f9f9; border:1px solid #ddd;
      border-radius:4px; display:none;
    }
    .print-options-inline label { margin-right:1rem; }
    @media print {
      nav, button, a.button, #reset-btn { display:none!important; }
      .user-info { display:flex!important; }
      body { background:#fff; margin:0; }
    }
  </style>
</head>
<body>
  <div id="container">
    <h1>🤖 Writing Assistant</h1>
    <button id="reset-btn">Reset</button>
    <nav>
      <button id="tab-feedback" class="tab active">피드백 코너</button>
      <button id="tab-final" class="tab">최종 산출물 코너</button>
    </nav>
    <section id="feedback-section" class="section active">
      <form id="feedback-form">
        <label>영작 내용을 입력하거나 이미지를 업로드하세요</label>
        <div class="user-info">
          <input type="text" id="user-name-feedback" placeholder="이름" />
          <input type="text" id="user-school-feedback" placeholder="학교" />
        </div>
        <div class="action-icons">
          <button type="button" class="icon-btn" title="사진 촬영">📷<input type="file" id="contentFile-camera-feedback" accept="image/*" capture="environment"/></button>
          <button type="button" class="icon-btn" title="이미지 선택">🖼️<input type="file" id="contentFile-gallery-feedback" accept="image/*"/></button>
        </div>
        <textarea id="contentText-feedback" class="input-area" placeholder="여기에 텍스트를 입력하세요"></textarea>
        <div id="file-info-feedback" class="file-info"><span class="file-name"></span></div>
        <div id="ocr-status-feedback" class="ocr-status"><div class="spinner"></div><span>이미지에서 텍스트를 추출 중입니다...</span></div>
        <button type="submit" id="submit-feedback-btn">Get Feedback<span id="submit-spinner-feedback" class="spinner"></span></button>
      </form>
      <div id="feedback-result"></div>
    </section>
    <section id="final-section" class="section">
      <form id="final-form">
        <label>최종 결과물을 위해 텍스트를 입력하거나 이미지를 업로드하세요</label>
        <div class="user-info">
          <input type="text" id="user-name-final" placeholder="이름" />
          <input type="text" id="user-school-final" placeholder="학교" />
        </div>
        <div class="action-icons">
          <button type="button" class="icon-btn" title="사진 촬영">📷<input type="file" id="contentFile-camera-final" accept="image/*" capture="environment"/></button>
          <button type="button" class="icon-btn" title="이미지 선택">🖼️<input type="file" id="contentFile-gallery-final" accept="image/*"/></button>
        </div>
        <textarea id="contentText-final" class="input-area" placeholder="여기에 텍스트를 입력하세요"></textarea>
        <div id="file-info-finals" class="file-info"><span class="file-name"></span></div>
        <div id="ocr-status-final" class="ocr-status"><div class="spinner"></div><span>이미지에서 텍스트를 추출 중입니다...</span></div>
        <button type="submit" id="submit-final-btn">Generate Final<span id="submit-spinner-final" class="spinner"></span></button>
      </form>
      <div id="final-result"></div>
      <div id="print-options-final" class="print-options-inline">
        <label><input type="checkbox" id="print_orig_fn" checked/> 원본</label>
        <label><input type="checkbox" id="print_corr_fn" checked/> 수정글</label>
        <button id="confirm-print-final-btn">Print</button>
      </div>
      <button id="print-final-btn" class="button">Print</button>
    </section>
  </div>
  <script>
    const WORKER_URL = 'https://writing-feedback-app.sehyunglee2015.workers.dev';
    const PROXY_URL  = WORKER_URL + '/proxy';
    window.feedbackFileURL = '';
    window.finalFileURL = '';
    document.getElementById('reset-btn').onclick = () => {
      ['feedback','final'].forEach(sec => {
        document.getElementById(`contentText-${sec}`).value = '';
        document.getElementById(`file-info-${sec}`).classList.remove('show');
        document.getElementById(`ocr-status-${sec}`).classList.remove('show');
        document.getElementById(`contentText-${sec}`).classList.remove('has-image');
        window[`${sec}FileURL`] = '';
        document.getElementById(`${sec}-result`).innerHTML = '';
        document.getElementById(`user-name-${sec}`).value = '';
        document.getElementById(`user-school-${sec}`).value = '';
      });
    };
    document.getElementById('tab-feedback').onclick = () => {
      document.getElementById('feedback-section').classList.add('active');
      document.getElementById('tab-feedback').classList.add('active');
      document.getElementById('final-section').classList.remove('active');
      document.getElementById('tab-final').classList.remove('active');
    };
    document.getElementById('tab-final').onclick = () => {
      document.getElementById('final-section').classList.add('active');
      document.getElementById('tab-final').classList.add('active');
      document.getElementById('feedback-section').classList.remove('active');
      document.getElementById('tab-feedback').classList.remove('active');
    };
    ['feedback','final'].forEach(section => {
      ['camera','gallery'].forEach(src => {
        document.getElementById(`contentFile-${src}-${section}`).addEventListener('change', e => {
          const file = e.target.files[0]; if(!file) return;
          const url = URL.createObjectURL(file);
          window[`${section}FileURL`] = url;
          const info = document.getElementById(`file-info-${section}`);
          info.querySelector('.file-name').textContent = file.name;
          info.classList.add('show');
          document.getElementById(`contentText-${section}`).classList.add('has-image');
          // OCR Logic...
        });
      });
    });
  </script>
</body>
</html>
